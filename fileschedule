Let me walk you through a detailed example with holidays and configuration files.

Configuration Files
File 1: file_schedule_config.csv
This is your master configuration stored in S3:
Location: s3://dmine-staging/config/schedules/file_schedule_config.csv
csvsource_id,file_pattern,schedule_type,schedule_config,expected_start_time,expected_end_time,grace_period_min,alert_severity,sns_topic,source_owner_email,holiday_calendar_id,is_active
TSYS,TSYS_TXN_*.dat,DAILY,,06:00,09:00,30,P1,arn:aws:sns:ca-central-1:xxxx:dmine-critical,tsys-support@bank.com,CA_BANK,TRUE
MECH,MECH_BANKING_*.csv,DAILY,,07:00,10:00,30,P1,arn:aws:sns:ca-central-1:xxxx:dmine-critical,mech-team@bank.com,CA_BANK,TRUE
XIM,XIM_FRAUD_*.parquet,WEEKLY,MONDAY;WEDNESDAY;FRIDAY,08:00,11:00,45,P2,arn:aws:sns:ca-central-1:xxxx:dmine-alerts,xim-support@bank.com,CA_BANK,TRUE
VENDOR_A,VENDOR_RISK_*.json,MONTHLY_WEEKDAY,LAST_TUESDAY,07:00,10:00,30,P2,arn:aws:sns:ca-central-1:xxxx:dmine-alerts,vendor-a@external.com,CA_BANK,TRUE
VENDOR_B,VENDOR_COMPLIANCE_*.dat,MONTHLY_DAY,15,09:00,14:00,60,P2,arn:aws:sns:ca-central-1:xxxx:dmine-alerts,vendor-b@external.com,CA_BANK,TRUE
REGULATORY,REG_FINTRAC_*.xml,BUSINESS_DAY,5,08:00,12:00,30,P1,arn:aws:sns:ca-central-1:xxxx:dmine-critical,regulatory@bank.com,CA_BANK,TRUE
CARDS,CARDS_DAILY_*.csv,DAILY,,06:30,08:30,30,P1,arn:aws:sns:ca-central-1:xxxx:dmine-critical,cards-ops@bank.com,CA_BANK,TRUE
AML,AML_ALERTS_*.parquet,DAILY,,07:00,09:00,30,P1,arn:aws:sns:ca-central-1:xxxx:dmine-critical,aml-team@bank.com,CA_BANK,TRUE
Column Descriptions:
ColumnDescriptionExample Valuessource_idUnique source identifierTSYS, MECH, XIMfile_patternExpected file name patternTSYS_TXN_*.datschedule_typeType of schedule ruleDAILY, WEEKLY, MONTHLY_WEEKDAY, MONTHLY_DAY, BUSINESS_DAYschedule_configParameters for the ruleMONDAY;WEDNESDAY;FRIDAY, LAST_TUESDAY, 15, 5expected_start_timeStart of arrival window06:00expected_end_timeEnd of arrival window09:00grace_period_minBuffer before alerting30alert_severityP1, P2, P3, P4P1sns_topicSNS ARN for alertsarn:aws:sns:...source_owner_emailContact for escalationtsys-support@bank.comholiday_calendar_idWhich holiday calendar to useCA_BANKis_activeEnable/disable monitoringTRUE, FALSE

File 2: holiday_calendar.csv
Location: s3://dmine-staging/config/holidays/holiday_calendar.csv
csvcalendar_id,holiday_date,holiday_name,is_bank_holiday,notes
CA_BANK,2026-01-01,New Year's Day,TRUE,Banks closed
CA_BANK,2026-02-16,Family Day (Ontario),TRUE,Provincial holiday
CA_BANK,2026-04-03,Good Friday,TRUE,Banks closed
CA_BANK,2026-04-06,Easter Monday,FALSE,Optional - some sources may send
CA_BANK,2026-05-18,Victoria Day,TRUE,Banks closed
CA_BANK,2026-07-01,Canada Day,TRUE,Banks closed
CA_BANK,2026-08-03,Civic Holiday,TRUE,Banks closed
CA_BANK,2026-09-07,Labour Day,TRUE,Banks closed
CA_BANK,2026-10-12,Thanksgiving,TRUE,Banks closed
CA_BANK,2026-11-11,Remembrance Day,TRUE,Banks closed
CA_BANK,2026-12-25,Christmas Day,TRUE,Banks closed
CA_BANK,2026-12-26,Boxing Day,TRUE,Banks closed
CA_BANK,2026-12-28,Boxing Day Observed,TRUE,Observed holiday
```

---

## Example Scenario: February 2026

### February 2026 Calendar
```
        February 2026
  Su   Mo   Tu   We   Th   Fr   Sa
   1    2    3    4    5    6    7
   8    9   10   11   12   13   14
  15  [16]  17   18   19   20   21
  22   23   24   25   26   27   28

  [16] = Family Day Holiday (Monday)
```

**Key Dates:**
- **Feb 16 (Monday)** = Family Day Holiday âŒ
- **Feb 17 (Tuesday)** = First business day after holiday
- **Feb 24 (Tuesday)** = Last Tuesday of February
- **Feb 15 (Sunday)** = 15th falls on weekend
- **Feb 6 (Friday)** = 5th Business Day of February

---

## Day-by-Day Evaluation

### **Evaluating Feb 16, 2026 (Family Day - Holiday)**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DATE: Monday, February 16, 2026                                        â”‚
â”‚  HOLIDAY CHECK: Family Day (Ontario) - CA_BANK calendar                 â”‚
â”‚  RESULT: BANK HOLIDAY = TRUE                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Evaluation for each source:**

| Source | Schedule Type | Rule Check | Holiday Impact | Expected? |
|--------|---------------|------------|----------------|-----------|
| TSYS | DAILY | Is business day? | NO - Holiday | âŒ NOT EXPECTED |
| MECH | DAILY | Is business day? | NO - Holiday | âŒ NOT EXPECTED |
| XIM | WEEKLY (Mon/Wed/Fri) | Is Monday? YES, but... | NO - Holiday | âŒ NOT EXPECTED |
| CARDS | DAILY | Is business day? | NO - Holiday | âŒ NOT EXPECTED |
| AML | DAILY | Is business day? | NO - Holiday | âŒ NOT EXPECTED |
| VENDOR_A | LAST_TUESDAY | Is last Tuesday? | NO | âŒ NOT EXPECTED |
| VENDOR_B | MONTHLY_DAY (15th) | Is 15th? NO (yesterday) | N/A | âŒ NOT EXPECTED |
| REGULATORY | BUSINESS_DAY (5th) | Is 5th biz day? | NO | âŒ NOT EXPECTED |

**Result:** No files expected on Feb 16 (Holiday) â†’ No sensors created â†’ No alerts

---

### **Evaluating Feb 17, 2026 (Tuesday - Day After Holiday)**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DATE: Tuesday, February 17, 2026                                       â”‚
â”‚  HOLIDAY CHECK: Not a holiday                                           â”‚
â”‚  RESULT: BUSINESS DAY = TRUE                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Evaluation for each source:**

| Source | Schedule Type | Rule Check | Expected? | Time Window |
|--------|---------------|------------|-----------|-------------|
| TSYS | DAILY | Is business day? YES | âœ… EXPECTED | 06:00-09:00 |
| MECH | DAILY | Is business day? YES | âœ… EXPECTED | 07:00-10:00 |
| XIM | WEEKLY (Mon/Wed/Fri) | Is Mon/Wed/Fri? NO (Tuesday) | âŒ NOT EXPECTED | - |
| CARDS | DAILY | Is business day? YES | âœ… EXPECTED | 06:30-08:30 |
| AML | DAILY | Is business day? YES | âœ… EXPECTED | 07:00-09:00 |
| VENDOR_A | LAST_TUESDAY | Is last Tuesday of Feb? NO (that's Feb 24) | âŒ NOT EXPECTED | - |
| VENDOR_B | MONTHLY_DAY (15th) | Is 15th? NO | âŒ NOT EXPECTED | - |
| REGULATORY | BUSINESS_DAY (5th) | Is 5th biz day of Feb? NO | âŒ NOT EXPECTED | - |

**Result:** 4 files expected (TSYS, MECH, CARDS, AML)

---

### **Evaluating Feb 24, 2026 (Last Tuesday of February)**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DATE: Tuesday, February 24, 2026                                       â”‚
â”‚  HOLIDAY CHECK: Not a holiday                                           â”‚
â”‚  SPECIAL: Last Tuesday of February                                      â”‚
â”‚  RESULT: BUSINESS DAY = TRUE                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**How "Last Tuesday" is calculated:**
```
February 2026 Tuesdays:
  - Feb 3  (1st Tuesday)
  - Feb 10 (2nd Tuesday)
  - Feb 17 (3rd Tuesday)
  - Feb 24 (4th Tuesday) â† LAST TUESDAY âœ“

Next Tuesday would be Mar 3 (different month)
Therefore: Feb 24 = Last Tuesday of February
```

**Evaluation for each source:**

| Source | Schedule Type | Rule Check | Expected? | Time Window |
|--------|---------------|------------|-----------|-------------|
| TSYS | DAILY | Is business day? YES | âœ… EXPECTED | 06:00-09:00 |
| MECH | DAILY | Is business day? YES | âœ… EXPECTED | 07:00-10:00 |
| XIM | WEEKLY (Mon/Wed/Fri) | Is Mon/Wed/Fri? NO | âŒ NOT EXPECTED | - |
| CARDS | DAILY | Is business day? YES | âœ… EXPECTED | 06:30-08:30 |
| AML | DAILY | Is business day? YES | âœ… EXPECTED | 07:00-09:00 |
| **VENDOR_A** | **LAST_TUESDAY** | **Is last Tue of Feb? YES** | **âœ… EXPECTED** | **07:00-10:00** |
| VENDOR_B | MONTHLY_DAY (15th) | Is 15th? NO | âŒ NOT EXPECTED | - |
| REGULATORY | BUSINESS_DAY (5th) | Is 5th biz day? NO | âŒ NOT EXPECTED | - |

**Result:** 5 files expected (TSYS, MECH, CARDS, AML, **VENDOR_A**)

---

### **Evaluating Feb 6, 2026 (5th Business Day)**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DATE: Friday, February 6, 2026                                         â”‚
â”‚  HOLIDAY CHECK: Not a holiday                                           â”‚
â”‚  SPECIAL: 5th Business Day of February                                  â”‚
â”‚  RESULT: BUSINESS DAY = TRUE                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**How "5th Business Day" is calculated:**
```
February 2026 Business Days:
  - Feb 2 (Mon) = 1st business day
  - Feb 3 (Tue) = 2nd business day
  - Feb 4 (Wed) = 3rd business day
  - Feb 5 (Thu) = 4th business day
  - Feb 6 (Fri) = 5th business day âœ“

(Feb 1 is Sunday, not counted)
```

**Evaluation:**

| Source | Schedule Type | Rule Check | Expected? | Time Window |
|--------|---------------|------------|-----------|-------------|
| TSYS | DAILY | Is business day? YES | âœ… EXPECTED | 06:00-09:00 |
| MECH | DAILY | Is business day? YES | âœ… EXPECTED | 07:00-10:00 |
| XIM | WEEKLY (Mon/Wed/Fri) | Is Friday? YES | âœ… EXPECTED | 08:00-11:00 |
| CARDS | DAILY | Is business day? YES | âœ… EXPECTED | 06:30-08:30 |
| AML | DAILY | Is business day? YES | âœ… EXPECTED | 07:00-09:00 |
| VENDOR_A | LAST_TUESDAY | Is last Tue? NO | âŒ NOT EXPECTED | - |
| VENDOR_B | MONTHLY_DAY (15th) | Is 15th? NO | âŒ NOT EXPECTED | - |
| **REGULATORY** | **BUSINESS_DAY (5th)** | **Is 5th biz day? YES** | **âœ… EXPECTED** | **08:00-12:00** |

**Result:** 6 files expected (TSYS, MECH, XIM, CARDS, AML, **REGULATORY**)

---

## Complex Scenario: Holiday Affects Business Day Calculation

### **March 2026 with Holiday Impact**
```
          March 2026
  Su   Mo   Tu   We   Th   Fr   Sa
   1    2    3    4    5    6    7
   8    9   10   11   12   13   14
  15   16   17   18   19   20   21
  22   23   24   25   26   27   28
  29   30   31

  No holidays in early March
```

**5th Business Day Calculation (Normal):**
- Mar 2 (Mon) = 1st
- Mar 3 (Tue) = 2nd
- Mar 4 (Wed) = 3rd
- Mar 5 (Thu) = 4th
- Mar 6 (Fri) = **5th business day** âœ“

---

### **April 2026 with Good Friday**
```
          April 2026
  Su   Mo   Tu   We   Th   Fr   Sa
               1    2   [3]   4
   5   [6]   7    8    9   10   11
  12   13   14   15   16   17   18
  19   20   21   22   23   24   25
  26   27   28   29   30

  [3] = Good Friday (Holiday)
  [6] = Easter Monday (Holiday - check config)
```

**5th Business Day Calculation (With Holidays):**
```
Assuming both Good Friday (Apr 3) and Easter Monday (Apr 6) are holidays:

- Apr 1 (Wed) = 1st business day
- Apr 2 (Thu) = 2nd business day
- Apr 3 (Fri) = HOLIDAY (Good Friday) âŒ NOT COUNTED
- Apr 4 (Sat) = Weekend âŒ
- Apr 5 (Sun) = Weekend âŒ
- Apr 6 (Mon) = HOLIDAY (Easter Monday) âŒ NOT COUNTED
- Apr 7 (Tue) = 3rd business day
- Apr 8 (Wed) = 4th business day
- Apr 9 (Thu) = 5th business day âœ“

REGULATORY file expected on April 9 (not April 7!)
```

---

## Full Walkthrough: Feb 24, 2026

Let me show the complete flow for **February 24, 2026** (Last Tuesday):

### **Step 1: DAG Triggered at 6:00 AM**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AIRFLOW DAG: dmine_file_monitor                                        â”‚
â”‚  Scheduled: 2026-02-24 06:00:00 EST                                     â”‚
â”‚  Status: RUNNING                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Step 2: Load Configuration Task**
```
Task: load_configuration
Status: RUNNING

Reading: s3://dmine-staging/config/schedules/file_schedule_config.csv
Reading: s3://dmine-staging/config/holidays/holiday_calendar.csv

Loaded:
  - 8 source configurations
  - 13 holidays for CA_BANK calendar
  - Active sources: 8

Status: SUCCESS âœ…
```

### **Step 3: Evaluate Schedule Task**
```
Task: evaluate_schedule
Status: RUNNING

Today's Date: 2026-02-24 (Tuesday)
Holiday Check: Not a holiday âœ“
Day of Week: Tuesday
Day of Month: 24
Business Day #: 17 (of February)

Evaluating TSYS (DAILY):
  â†’ Is business day? YES
  â†’ Result: EXPECTED âœ…

Evaluating MECH (DAILY):
  â†’ Is business day? YES
  â†’ Result: EXPECTED âœ…

Evaluating XIM (WEEKLY - Mon/Wed/Fri):
  â†’ Is today Monday? NO
  â†’ Is today Wednesday? NO
  â†’ Is today Friday? NO
  â†’ Result: NOT EXPECTED âŒ

Evaluating CARDS (DAILY):
  â†’ Is business day? YES
  â†’ Result: EXPECTED âœ…

Evaluating AML (DAILY):
  â†’ Is business day? YES
  â†’ Result: EXPECTED âœ…

Evaluating VENDOR_A (LAST_TUESDAY):
  â†’ Finding all Tuesdays in February 2026: [3, 10, 17, 24]
  â†’ Last Tuesday: 24
  â†’ Is today the 24th? YES
  â†’ Result: EXPECTED âœ…

Evaluating VENDOR_B (MONTHLY_DAY - 15th):
  â†’ Is today the 15th? NO
  â†’ Result: NOT EXPECTED âŒ

Evaluating REGULATORY (BUSINESS_DAY - 5th):
  â†’ 5th business day of Feb was: Feb 6
  â†’ Is today Feb 6? NO
  â†’ Result: NOT EXPECTED âŒ

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SUMMARY: 5 files expected today
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Writing to: s3://dmine-staging/tracking/expected/date=2026-02-24/expected.parquet

Status: SUCCESS âœ…
```

### **Step 4: Dynamic Sensor Tasks Created**
```
Creating S3KeySensor tasks for 5 expected files:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Task: sensor_TSYS                                                        â”‚
â”‚ Bucket: dmine-landing                                                    â”‚
â”‚ Key Pattern: tsys/TSYS_TXN_*.dat                                        â”‚
â”‚ Timeout: 09:30 (09:00 + 30 min grace)                                   â”‚
â”‚ Poke Interval: 300 seconds (5 min)                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Task: sensor_MECH                                                        â”‚
â”‚ Bucket: dmine-landing                                                    â”‚
â”‚ Key Pattern: mech/MECH_BANKING_*.csv                                    â”‚
â”‚ Timeout: 10:30 (10:00 + 30 min grace)                                   â”‚
â”‚ Poke Interval: 300 seconds                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Task: sensor_CARDS                                                       â”‚
â”‚ Bucket: dmine-landing                                                    â”‚
â”‚ Key Pattern: cards/CARDS_DAILY_*.csv                                    â”‚
â”‚ Timeout: 09:00 (08:30 + 30 min grace)                                   â”‚
â”‚ Poke Interval: 300 seconds                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Task: sensor_AML                                                         â”‚
â”‚ Bucket: dmine-landing                                                    â”‚
â”‚ Key Pattern: aml/AML_ALERTS_*.parquet                                   â”‚
â”‚ Timeout: 09:30 (09:00 + 30 min grace)                                   â”‚
â”‚ Poke Interval: 300 seconds                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Task: sensor_VENDOR_A                                                    â”‚
â”‚ Bucket: dmine-landing                                                    â”‚
â”‚ Key Pattern: vendor_a/VENDOR_RISK_*.json                                â”‚
â”‚ Timeout: 10:30 (10:00 + 30 min grace)                                   â”‚
â”‚ Poke Interval: 300 seconds                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Step 5: Files Arrive (or Don't)**

**Timeline of Events:**
```
06:15 - sensor_CARDS: Checking s3://dmine-landing/cards/CARDS_DAILY_*.csv
        â†’ No file found, will retry in 5 min

06:20 - sensor_CARDS: Checking again...
        â†’ No file found

06:22 - FILE ARRIVED: s3://dmine-landing/cards/CARDS_DAILY_20260224_062201.csv
        
06:25 - sensor_CARDS: Checking again...
        â†’ FILE FOUND! âœ…
        â†’ Status: SUCCESS
        â†’ Arrival: 06:22 (ON-TIME, within 06:30-08:30 window... actually EARLY!)

06:30 - sensor_TSYS: Checking s3://dmine-landing/tsys/TSYS_TXN_*.dat
        â†’ No file found

06:35 - sensor_TSYS: Checking again...
        â†’ No file found

06:47 - FILE ARRIVED: s3://dmine-landing/tsys/TSYS_TXN_20260224_064712.dat

06:50 - sensor_TSYS: Checking again...
        â†’ FILE FOUND! âœ…
        â†’ Status: SUCCESS
        â†’ Arrival: 06:47 (ON-TIME)

07:15 - sensor_MECH: FILE FOUND!
        â†’ s3://dmine-landing/mech/MECH_BANKING_20260224_071455.csv
        â†’ Status: SUCCESS âœ…

07:30 - sensor_AML: FILE FOUND!
        â†’ s3://dmine-landing/aml/AML_ALERTS_20260224_072833.parquet
        â†’ Status: SUCCESS âœ…

... time passes ...

10:00 - sensor_VENDOR_A: Still checking...
        â†’ No file found
        â†’ Expected window ended (07:00-10:00)
        â†’ Grace period started

10:15 - sensor_VENDOR_A: Checking...
        â†’ No file found

10:30 - sensor_VENDOR_A: TIMEOUT REACHED! âŒ
        â†’ Expected: 07:00-10:00
        â†’ Grace: 30 minutes
        â†’ Deadline: 10:30
        â†’ Status: FAILED (timeout)
        â†’ Triggering alert task
```

### **Step 6: Alert Generated for VENDOR_A**
```
Task: alert_VENDOR_A
Status: RUNNING

Preparing SNS notification...

Topic: arn:aws:sns:ca-central-1:xxxx:dmine-alerts
Severity: P2 - HIGH

Message:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸš¨ DMINE FILE ARRIVAL ALERT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Alert Level:      P2 - HIGH
Source System:    VENDOR_A
File Pattern:     VENDOR_RISK_*.json
Schedule Rule:    LAST TUESDAY OF MONTH

Expected Date:    2026-02-24 (Last Tuesday of February)
Expected Window:  07:00 - 10:00 EST
Grace Period:     30 minutes
Deadline:         10:30 EST
Current Time:     10:30 EST
Status:           âš ï¸ MISSING

Landing Path:     s3://dmine-landing/vendor_a/

Last Successful Arrival:
  Date:           2026-01-27
  File:           VENDOR_RISK_20260127_083042.json
  Time:           08:30:42 EST

Source Owner:     vendor-a@external.com
Runbook:          https://wiki.bank.com/dmine/vendor-a-missing

Recommended Action:
  1. Contact VENDOR_A source team
  2. Check for upstream processing issues
  3. Verify file generation on source side

This is an automated alert from DMINE File Monitoring System.
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Status: SUCCESS âœ… (SNS published)
```

### **Step 7: Update Tracking Table**
```
Task: update_tracking
Status: RUNNING

Writing results to: s3://dmine-staging/tracking/arrivals/date=2026-02-24/

Results:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ source_id  â”‚ file_name               â”‚ status   â”‚ arrival   â”‚ mins_late   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ CARDS      â”‚ CARDS_DAILY_20260224... â”‚ ON_TIME  â”‚ 06:22:01  â”‚ 0 (early)   â”‚
â”‚ TSYS       â”‚ TSYS_TXN_20260224...    â”‚ ON_TIME  â”‚ 06:47:12  â”‚ 0           â”‚
â”‚ MECH       â”‚ MECH_BANKING_20260224...â”‚ ON_TIME  â”‚ 07:14:55  â”‚ 0           â”‚
â”‚ AML        â”‚ AML_ALERTS_20260224...  â”‚ ON_TIME  â”‚ 07:28:33  â”‚ 0           â”‚
â”‚ VENDOR_A   â”‚ (none)                  â”‚ MISSING  â”‚ -         â”‚ -           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Status: SUCCESS âœ…
```

---

## Airflow UI View
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DAG: dmine_file_monitor                                                    â”‚
â”‚  Run ID: scheduled__2026-02-24T06:00:00+00:00                               â”‚
â”‚  State: SUCCESS (with failures)                                             â”‚
â”‚  Duration: 4h 35m                                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  TASK GRAPH:                                                                â”‚
â”‚                                                                             â”‚
â”‚  load_config â”€â”€â–º evaluate_schedule â”€â”€â”¬â”€â”€â–º sensor_TSYS â”€â”€â”€â”€â–º log_arrival âœ…  â”‚
â”‚       âœ…               âœ…             â”‚         âœ…                           â”‚
â”‚                                      â”œâ”€â”€â–º sensor_MECH â”€â”€â”€â”€â–º log_arrival âœ…  â”‚
â”‚                                      â”‚         âœ…                           â”‚
â”‚                                      â”œâ”€â”€â–º sensor_CARDS â”€â”€â”€â–º log_arrival âœ…  â”‚
â”‚                                      â”‚         âœ…                           â”‚
â”‚                                      â”œâ”€â”€â–º sensor_AML â”€â”€â”€â”€â”€â–º log_arrival âœ…  â”‚
â”‚                                      â”‚         âœ…                           â”‚
â”‚                                      â””â”€â”€â–º sensor_VENDOR_A â”€â–º alert_task ğŸš¨  â”‚
â”‚                                                 âŒ (timeout)       âœ…       â”‚
â”‚                                                                             â”‚
â”‚                                      update_tracking âœ…                     â”‚
â”‚                                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  TASK DURATIONS:                                                            â”‚
â”‚  âœ… load_config        00:00:08                                             â”‚
â”‚  âœ… evaluate_schedule  00:00:15                                             â”‚
â”‚  âœ… sensor_TSYS        00:20:12  (found at 06:47)                           â”‚
â”‚  âœ… sensor_MECH        01:14:55  (found at 07:15)                           â”‚
â”‚  âœ… sensor_CARDS       00:22:01  (found at 06:22)                           â”‚
â”‚  âœ… sensor_AML         01:28:33  (found at 07:28)                           â”‚
â”‚  âŒ sensor_VENDOR_A    04:30:00  (TIMEOUT at 10:30)                         â”‚
â”‚  âœ… alert_VENDOR_A     00:00:03                                             â”‚
â”‚  âœ… update_tracking    00:00:12                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Summary: Configuration + Holiday Logic
ScenarioHow System Handles ItHoliday (e.g., Family Day)Checks holiday_calendar.csv â†’ Skips all DAILY files â†’ No sensors createdDay after HolidayNormal business day â†’ DAILY files expectedLast Tuesday of MonthCalculates all Tuesdays in month â†’ Finds last one â†’ Creates sensor if match5th Business DayCounts only non-holiday weekdays â†’ Creates sensor on correct day15th falls on WeekendMONTHLY_DAY still expects on 15th (or can configure to shift to next business day)File arrives lateSensor times out â†’ Alert sent â†’ If file arrives later, tracking updated to LATE

Would you like me to create a formal solution document with these configuration examples and flows?how the evaluate files process will work2:20 PMArchitected detailed logic flows for file evaluation processGreat question! Let me break down the Evaluate Expected Files process in detail - this is the core brain of the entire solution.

Evaluate Expected Files Process
Overview
This process runs once daily (typically at start of day) and determines which files are expected TODAY based on:

Schedule configuration rules
Holiday calendar
Business day calculations


Process Flow Diagram
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    EVALUATE EXPECTED FILES PROCESS                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  STEP 1: LOAD INPUTS          â”‚
                    â”‚  â€¢ file_schedule_config.csv   â”‚
                    â”‚  â€¢ holiday_calendar.csv       â”‚
                    â”‚  â€¢ Current date               â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  STEP 2: CHECK IF TODAY IS    â”‚
                    â”‚  A HOLIDAY                    â”‚
                    â”‚  (Lookup in holiday calendar) â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                               â”‚
                    â–¼                               â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  IS HOLIDAY  â”‚               â”‚ NOT HOLIDAY  â”‚
            â”‚  (Bank Day)  â”‚               â”‚ (Business    â”‚
            â”‚              â”‚               â”‚    Day)      â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                               â”‚
                    â–¼                               â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Skip all     â”‚               â”‚ STEP 3: LOOP THROUGH â”‚
            â”‚ DAILY files  â”‚               â”‚ EACH SOURCE CONFIG   â”‚
            â”‚ (may still   â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚ check others)â”‚                        â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚  STEP 4: EVALUATE SCHEDULE    â”‚
                                    â”‚  RULE FOR EACH SOURCE         â”‚
                                    â”‚                               â”‚
                                    â”‚  Based on schedule_type:      â”‚
                                    â”‚  â€¢ DAILY                      â”‚
                                    â”‚  â€¢ WEEKLY                     â”‚
                                    â”‚  â€¢ MONTHLY_DAY                â”‚
                                    â”‚  â€¢ MONTHLY_WEEKDAY            â”‚
                                    â”‚  â€¢ BUSINESS_DAY               â”‚
                                    â”‚  â€¢ QUARTERLY                  â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                    â”‚
                                                    â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚  STEP 5: BUILD EXPECTED       â”‚
                                    â”‚  FILES LIST                   â”‚
                                    â”‚                               â”‚
                                    â”‚  For each matched rule:       â”‚
                                    â”‚  â€¢ source_id                  â”‚
                                    â”‚  â€¢ file_pattern               â”‚
                                    â”‚  â€¢ expected_start_time        â”‚
                                    â”‚  â€¢ expected_end_time          â”‚
                                    â”‚  â€¢ deadline (end + grace)     â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                    â”‚
                                                    â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚  STEP 6: WRITE TO S3          â”‚
                                    â”‚  expected_files/date=YYYY-MM-DDâ”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step-by-Step Logic
STEP 1: Load Inputs
INPUTS:
â”œâ”€â”€ file_schedule_config.csv (from S3)
â”‚     â†’ All source configurations with schedule rules
â”‚
â”œâ”€â”€ holiday_calendar.csv (from S3)
â”‚     â†’ All holidays for the applicable calendar
â”‚
â””â”€â”€ Current Date
      â†’ Today's date (e.g., 2026-02-24)
      â†’ Derived: Day of Week (Tuesday)
      â†’ Derived: Day of Month (24)
      â†’ Derived: Month (February)
      â†’ Derived: Year (2026)

STEP 2: Check Holiday Status
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  HOLIDAY CHECK LOGIC                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  INPUT: today_date = 2026-02-16                                â”‚
â”‚  INPUT: calendar_id = CA_BANK                                   â”‚
â”‚                                                                 â”‚
â”‚  LOOKUP: Search holiday_calendar.csv                            â”‚
â”‚          WHERE calendar_id = 'CA_BANK'                          â”‚
â”‚          AND holiday_date = '2026-02-16'                        â”‚
â”‚                                                                 â”‚
â”‚  FOUND:  holiday_date = 2026-02-16                             â”‚
â”‚          holiday_name = "Family Day"                            â”‚
â”‚          is_bank_holiday = TRUE                                 â”‚
â”‚                                                                 â”‚
â”‚  RESULT: is_holiday = TRUE                                      â”‚
â”‚          is_business_day = FALSE                                â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Also determine:

Is today a weekend? (Saturday/Sunday)
Combined check: is_business_day = NOT(is_weekend) AND NOT(is_holiday)


STEP 3: Loop Through Each Source Configuration
FOR EACH source IN file_schedule_config:
    
    IF source.is_active = FALSE:
        SKIP (source is disabled)
    
    IF source.holiday_calendar_id != current_calendar:
        SKIP (different calendar applies)
    
    EVALUATE schedule rule...

STEP 4: Evaluate Schedule Rules
This is the core logic - different evaluation for each schedule type:

Rule Type: DAILY
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RULE: DAILY                                                    â”‚
â”‚  Config: (none needed)                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  LOGIC:                                                         â”‚
â”‚                                                                 â”‚
â”‚  IF is_business_day = TRUE                                      â”‚
â”‚      THEN file_expected = TRUE                                  â”‚
â”‚      ELSE file_expected = FALSE                                 â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  EXAMPLE 1: Feb 17, 2026 (Tuesday, not holiday)                â”‚
â”‚      is_business_day = TRUE                                     â”‚
â”‚      â†’ EXPECTED âœ…                                              â”‚
â”‚                                                                 â”‚
â”‚  EXAMPLE 2: Feb 16, 2026 (Monday, Family Day)                  â”‚
â”‚      is_business_day = FALSE (holiday)                          â”‚
â”‚      â†’ NOT EXPECTED âŒ                                          â”‚
â”‚                                                                 â”‚
â”‚  EXAMPLE 3: Feb 14, 2026 (Saturday)                            â”‚
â”‚      is_business_day = FALSE (weekend)                          â”‚
â”‚      â†’ NOT EXPECTED âŒ                                          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Rule Type: WEEKLY
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RULE: WEEKLY                                                   â”‚
â”‚  Config: schedule_config = "MONDAY;WEDNESDAY;FRIDAY"            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  LOGIC:                                                         â”‚
â”‚                                                                 â”‚
â”‚  1. Parse config into list: [MONDAY, WEDNESDAY, FRIDAY]         â”‚
â”‚  2. Get today's day of week                                     â”‚
â”‚  3. Check if today is in the list                               â”‚
â”‚  4. Also check if today is a business day                       â”‚
â”‚                                                                 â”‚
â”‚  IF today_day_of_week IN config_days                            â”‚
â”‚     AND is_business_day = TRUE                                  â”‚
â”‚      THEN file_expected = TRUE                                  â”‚
â”‚      ELSE file_expected = FALSE                                 â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  EXAMPLE 1: Feb 20, 2026 (Friday, not holiday)                 â”‚
â”‚      today_day = FRIDAY                                         â”‚
â”‚      FRIDAY in [MON, WED, FRI]? YES                            â”‚
â”‚      is_business_day = TRUE                                     â”‚
â”‚      â†’ EXPECTED âœ…                                              â”‚
â”‚                                                                 â”‚
â”‚  EXAMPLE 2: Feb 24, 2026 (Tuesday)                             â”‚
â”‚      today_day = TUESDAY                                        â”‚
â”‚      TUESDAY in [MON, WED, FRI]? NO                            â”‚
â”‚      â†’ NOT EXPECTED âŒ                                          â”‚
â”‚                                                                 â”‚
â”‚  EXAMPLE 3: Apr 3, 2026 (Friday, Good Friday holiday)          â”‚
â”‚      today_day = FRIDAY                                         â”‚
â”‚      FRIDAY in [MON, WED, FRI]? YES                            â”‚
â”‚      is_business_day = FALSE (holiday)                          â”‚
â”‚      â†’ NOT EXPECTED âŒ                                          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Rule Type: MONTHLY_DAY
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RULE: MONTHLY_DAY                                              â”‚
â”‚  Config: schedule_config = "15"                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  LOGIC:                                                         â”‚
â”‚                                                                 â”‚
â”‚  1. Parse config to get target day: 15                          â”‚
â”‚  2. Get today's day of month                                    â”‚
â”‚  3. Check if they match                                         â”‚
â”‚                                                                 â”‚
â”‚  IF today_day_of_month = config_day                             â”‚
â”‚      THEN file_expected = TRUE                                  â”‚
â”‚      ELSE file_expected = FALSE                                 â”‚
â”‚                                                                 â”‚
â”‚  NOTE: This rule typically does NOT check for business day      â”‚
â”‚        (file expected on 15th regardless of weekend/holiday)    â”‚
â”‚        Can be configured differently if needed.                 â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  EXAMPLE 1: Feb 15, 2026 (Sunday)                              â”‚
â”‚      today_day_of_month = 15                                    â”‚
â”‚      config_day = 15                                            â”‚
â”‚      15 = 15? YES                                               â”‚
â”‚      â†’ EXPECTED âœ… (even though Sunday)                         â”‚
â”‚                                                                 â”‚
â”‚  EXAMPLE 2: Feb 16, 2026 (Monday)                              â”‚
â”‚      today_day_of_month = 16                                    â”‚
â”‚      config_day = 15                                            â”‚
â”‚      16 = 15? NO                                                â”‚
â”‚      â†’ NOT EXPECTED âŒ                                          â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  VARIANT: MONTHLY_DAY_OR_NEXT_BUSINESS                          â”‚
â”‚                                                                 â”‚
â”‚  If 15th falls on weekend/holiday, shift to next business day: â”‚
â”‚                                                                 â”‚
â”‚  Feb 15 (Sunday) â†’ Feb 16 (Monday)... but Feb 16 is holiday    â”‚
â”‚                  â†’ Feb 17 (Tuesday) = Expected date             â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Rule Type: MONTHLY_WEEKDAY (e.g., Last Tuesday)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RULE: MONTHLY_WEEKDAY                                          â”‚
â”‚  Config: schedule_config = "LAST_TUESDAY"                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  LOGIC:                                                         â”‚
â”‚                                                                 â”‚
â”‚  1. Parse config:                                               â”‚
â”‚     - Occurrence: LAST (could be 1ST, 2ND, 3RD, 4TH, LAST)     â”‚
â”‚     - Day of week: TUESDAY                                      â”‚
â”‚                                                                 â”‚
â”‚  2. Find all Tuesdays in current month                         â”‚
â”‚                                                                 â”‚
â”‚  3. Select the correct occurrence:                              â”‚
â”‚     - 1ST = first Tuesday                                       â”‚
â”‚     - 2ND = second Tuesday                                      â”‚
â”‚     - LAST = last Tuesday                                       â”‚
â”‚                                                                 â”‚
â”‚  4. Check if today matches that date                            â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  DETAILED CALCULATION FOR FEBRUARY 2026:                        â”‚
â”‚                                                                 â”‚
â”‚  Step 2a: Get first day of month                                â”‚
â”‚           Feb 1, 2026 = Sunday                                  â”‚
â”‚                                                                 â”‚
â”‚  Step 2b: Find first Tuesday                                    â”‚
â”‚           Feb 1 (Sun) + 2 days = Feb 3 (Tue) âœ“                 â”‚
â”‚                                                                 â”‚
â”‚  Step 2c: List all Tuesdays (add 7 days each time)             â”‚
â”‚           Feb 3  (1st Tuesday)                                  â”‚
â”‚           Feb 10 (2nd Tuesday)                                  â”‚
â”‚           Feb 17 (3rd Tuesday)                                  â”‚
â”‚           Feb 24 (4th Tuesday)                                  â”‚
â”‚           Mar 3  (would be 5th, but different month - STOP)    â”‚
â”‚                                                                 â”‚
â”‚  Step 3: Select LAST Tuesday                                    â”‚
â”‚          Last in list = Feb 24                                  â”‚
â”‚                                                                 â”‚
â”‚  Step 4: Is today Feb 24?                                       â”‚
â”‚          If YES â†’ EXPECTED âœ…                                   â”‚
â”‚          If NO  â†’ NOT EXPECTED âŒ                               â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  OTHER EXAMPLES:                                                â”‚
â”‚                                                                 â”‚
â”‚  Config: "1ST_MONDAY"                                           â”‚
â”‚  March 2026: Mar 2 = 1st Monday                                â”‚
â”‚                                                                 â”‚
â”‚  Config: "3RD_FRIDAY"                                           â”‚
â”‚  March 2026: Mar 6, 13, 20, 27 = Fridays                       â”‚
â”‚              Mar 20 = 3rd Friday                                â”‚
â”‚                                                                 â”‚
â”‚  Config: "LAST_FRIDAY"                                          â”‚
â”‚  March 2026: Mar 27 = Last Friday                              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Rule Type: BUSINESS_DAY (e.g., 5th Business Day)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RULE: BUSINESS_DAY                                             â”‚
â”‚  Config: schedule_config = "5"                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  LOGIC:                                                         â”‚
â”‚                                                                 â”‚
â”‚  1. Parse config to get target: 5th business day                â”‚
â”‚                                                                 â”‚
â”‚  2. Calculate all business days in current month                â”‚
â”‚     - Start from 1st of month                                   â”‚
â”‚     - Count only days that are:                                 â”‚
â”‚       â€¢ NOT Saturday                                            â”‚
â”‚       â€¢ NOT Sunday                                              â”‚
â”‚       â€¢ NOT in holiday_calendar                                 â”‚
â”‚                                                                 â”‚
â”‚  3. Find the Nth business day                                   â”‚
â”‚                                                                 â”‚
â”‚  4. Check if today matches that date                            â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  DETAILED CALCULATION FOR FEBRUARY 2026:                        â”‚
â”‚                                                                 â”‚
â”‚  Feb 1  (Sun) - Weekend       â†’ NOT business day               â”‚
â”‚  Feb 2  (Mon) - No holiday    â†’ Business Day #1                â”‚
â”‚  Feb 3  (Tue) - No holiday    â†’ Business Day #2                â”‚
â”‚  Feb 4  (Wed) - No holiday    â†’ Business Day #3                â”‚
â”‚  Feb 5  (Thu) - No holiday    â†’ Business Day #4                â”‚
â”‚  Feb 6  (Fri) - No holiday    â†’ Business Day #5 âœ“              â”‚
â”‚  Feb 7  (Sat) - Weekend       â†’ NOT business day               â”‚
â”‚  Feb 8  (Sun) - Weekend       â†’ NOT business day               â”‚
â”‚  Feb 9  (Mon) - No holiday    â†’ Business Day #6                â”‚
â”‚  ...                                                            â”‚
â”‚                                                                 â”‚
â”‚  5th Business Day = Feb 6                                       â”‚
â”‚                                                                 â”‚
â”‚  Is today Feb 6?                                                â”‚
â”‚      If YES â†’ EXPECTED âœ…                                       â”‚
â”‚      If NO  â†’ NOT EXPECTED âŒ                                   â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  EXAMPLE WITH HOLIDAY (April 2026):                             â”‚
â”‚                                                                 â”‚
â”‚  Apr 1  (Wed) - No holiday    â†’ Business Day #1                â”‚
â”‚  Apr 2  (Thu) - No holiday    â†’ Business Day #2                â”‚
â”‚  Apr 3  (Fri) - GOOD FRIDAY   â†’ NOT business day (HOLIDAY)     â”‚
â”‚  Apr 4  (Sat) - Weekend       â†’ NOT business day               â”‚
â”‚  Apr 5  (Sun) - Weekend       â†’ NOT business day               â”‚
â”‚  Apr 6  (Mon) - EASTER MON    â†’ NOT business day (HOLIDAY)     â”‚
â”‚  Apr 7  (Tue) - No holiday    â†’ Business Day #3                â”‚
â”‚  Apr 8  (Wed) - No holiday    â†’ Business Day #4                â”‚
â”‚  Apr 9  (Thu) - No holiday    â†’ Business Day #5 âœ“              â”‚
â”‚                                                                 â”‚
â”‚  5th Business Day = Apr 9 (NOT Apr 7!)                         â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Rule Type: QUARTERLY (Last Business Day of Quarter)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RULE: QUARTERLY                                                â”‚
â”‚  Config: schedule_config = "LAST_BUSINESS_DAY"                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  LOGIC:                                                         â”‚
â”‚                                                                 â”‚
â”‚  1. Determine current quarter:                                  â”‚
â”‚     Q1 = Jan, Feb, Mar (ends Mar 31)                           â”‚
â”‚     Q2 = Apr, May, Jun (ends Jun 30)                           â”‚
â”‚     Q3 = Jul, Aug, Sep (ends Sep 30)                           â”‚
â”‚     Q4 = Oct, Nov, Dec (ends Dec 31)                           â”‚
â”‚                                                                 â”‚
â”‚  2. Find last day of quarter                                    â”‚
â”‚                                                                 â”‚
â”‚  3. Work backwards to find last business day:                   â”‚
â”‚     - If last day is business day â†’ use it                     â”‚
â”‚     - If weekend/holiday â†’ go back one day, repeat             â”‚
â”‚                                                                 â”‚
â”‚  4. Check if today matches                                      â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  EXAMPLE: Q1 2026 (ends March 31)                              â”‚
â”‚                                                                 â”‚
â”‚  Mar 31, 2026 = Tuesday                                        â”‚
â”‚  Is it a holiday? NO                                            â”‚
â”‚  Is it a weekend? NO                                            â”‚
â”‚  â†’ Last business day of Q1 = March 31                          â”‚
â”‚                                                                 â”‚
â”‚  Is today March 31?                                             â”‚
â”‚      If YES â†’ EXPECTED âœ…                                       â”‚
â”‚      If NO  â†’ NOT EXPECTED âŒ                                   â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  EXAMPLE: Q2 2026 (ends June 30)                               â”‚
â”‚                                                                 â”‚
â”‚  Jun 30, 2026 = Tuesday                                        â”‚
â”‚  Is it a holiday? NO                                            â”‚
â”‚  Is it a weekend? NO                                            â”‚
â”‚  â†’ Last business day of Q2 = June 30                           â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  EXAMPLE: Q4 2025 (ends December 31)                           â”‚
â”‚                                                                 â”‚
â”‚  Dec 31, 2025 = Wednesday                                      â”‚
â”‚  Is it a holiday? Possibly (New Year's Eve)                    â”‚
â”‚                                                                 â”‚
â”‚  If Dec 31 is holiday:                                          â”‚
â”‚      Dec 30, 2025 = Tuesday â†’ Last business day               â”‚
â”‚                                                                 â”‚
â”‚  If Dec 31 is NOT holiday:                                      â”‚
â”‚      Dec 31 = Last business day                                â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 5: Build Expected Files List
After evaluating all sources, compile the final list:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EXPECTED FILES FOR: 2026-02-24                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Source     Rule              Result        Reason              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  TSYS       DAILY             âœ… EXPECTED   Business day        â”‚
â”‚  MECH       DAILY             âœ… EXPECTED   Business day        â”‚
â”‚  XIM        WEEKLY(M/W/F)     âŒ SKIP       Today is Tuesday    â”‚
â”‚  CARDS      DAILY             âœ… EXPECTED   Business day        â”‚
â”‚  AML        DAILY             âœ… EXPECTED   Business day        â”‚
â”‚  VENDOR_A   LAST_TUESDAY      âœ… EXPECTED   Feb 24 = Last Tue   â”‚
â”‚  VENDOR_B   MONTHLY_DAY(15)   âŒ SKIP       Today is 24th       â”‚
â”‚  REGULATORY BUSINESS_DAY(5)   âŒ SKIP       5th biz day was Feb 6â”‚
â”‚                                                                 â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚  TOTAL EXPECTED: 5 files                                        â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Build output records:
expected_files = [
    {
        source_id: "TSYS",
        file_pattern: "TSYS_TXN_*.dat",
        expected_date: "2026-02-24",
        expected_start_time: "06:00",
        expected_end_time: "09:00",
        grace_period_min: 30,
        deadline: "09:30",
        alert_severity: "P1",
        sns_topic: "arn:aws:sns:...:dmine-critical",
        status: "PENDING",
        s3_path: "s3://dmine-landing/tsys/"
    },
    {
        source_id: "MECH",
        file_pattern: "MECH_BANKING_*.csv",
        expected_date: "2026-02-24",
        expected_start_time: "07:00",
        expected_end_time: "10:00",
        grace_period_min: 30,
        deadline: "10:30",
        alert_severity: "P1",
        sns_topic: "arn:aws:sns:...:dmine-critical",
        status: "PENDING",
        s3_path: "s3://dmine-landing/mech/"
    },
    ... (CARDS, AML, VENDOR_A)
]

STEP 6: Write to S3
OUTPUT FILE: s3://dmine-staging/tracking/expected/date=2026-02-24/expected.parquet

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ source_id  â”‚ file_pattern        â”‚ expected_dateâ”‚ start  â”‚ end    â”‚ deadline â”‚ status  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TSYS       â”‚ TSYS_TXN_*.dat      â”‚ 2026-02-24   â”‚ 06:00  â”‚ 09:00  â”‚ 09:30    â”‚ PENDING â”‚
â”‚ MECH       â”‚ MECH_BANKING_*.csv  â”‚ 2026-02-24   â”‚ 07:00  â”‚ 10:00  â”‚ 10:30    â”‚ PENDING â”‚
â”‚ CARDS      â”‚ CARDS_DAILY_*.csv   â”‚ 2026-02-24   â”‚ 06:30  â”‚ 08:30  â”‚ 09:00    â”‚ PENDING â”‚
â”‚ AML        â”‚ AML_ALERTS_*.parquetâ”‚ 2026-02-24   â”‚ 07:00  â”‚ 09:00  â”‚ 09:30    â”‚ PENDING â”‚
â”‚ VENDOR_A   â”‚ VENDOR_RISK_*.json  â”‚ 2026-02-24   â”‚ 07:00  â”‚ 10:00  â”‚ 10:30    â”‚ PENDING â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Also registered in Glue Catalog for Athena queries.

Summary: Decision Tree
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚  START: Today   â”‚
                            â”‚  = 2026-02-24   â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚  Is Holiday?    â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ YES                            â”‚ NO
                    â–¼                                â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Skip DAILY    â”‚               â”‚ Check Each    â”‚
            â”‚ files         â”‚               â”‚ Source Rule   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                               â”‚                               â”‚
                    â–¼                               â–¼                               â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ DAILY         â”‚               â”‚ WEEKLY        â”‚               â”‚ MONTHLY_      â”‚
            â”‚               â”‚               â”‚               â”‚               â”‚ WEEKDAY       â”‚
            â”‚ Is biz day?   â”‚               â”‚ Today in      â”‚               â”‚               â”‚
            â”‚ YES â†’ âœ…      â”‚               â”‚ config days?  â”‚               â”‚ Calculate     â”‚
            â”‚ NO  â†’ âŒ      â”‚               â”‚ AND biz day?  â”‚               â”‚ Nth weekday   â”‚
            â”‚               â”‚               â”‚ YES â†’ âœ…      â”‚               â”‚ of month      â”‚
            â”‚               â”‚               â”‚ NO  â†’ âŒ      â”‚               â”‚ Match? â†’ âœ…   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                               â”‚                               â”‚
                    â–¼                               â–¼                               â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ MONTHLY_DAY   â”‚               â”‚ BUSINESS_DAY  â”‚               â”‚ QUARTERLY     â”‚
            â”‚               â”‚               â”‚               â”‚               â”‚               â”‚
            â”‚ Today = Nth   â”‚               â”‚ Count biz     â”‚               â”‚ Find last     â”‚
            â”‚ of month?     â”‚               â”‚ days in month â”‚               â”‚ biz day of    â”‚
            â”‚ YES â†’ âœ…      â”‚               â”‚ (skip holidaysâ”‚               â”‚ quarter       â”‚
            â”‚ NO  â†’ âŒ      â”‚               â”‚ & weekends)   â”‚               â”‚ Match? â†’ âœ…   â”‚
            â”‚               â”‚               â”‚ Match? â†’ âœ…   â”‚               â”‚               â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                    â”‚
                                                    â–¼
                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                            â”‚ Compile all   â”‚
                                            â”‚ EXPECTED âœ…   â”‚
                                            â”‚ sources into  â”‚
                                            â”‚ output file   â”‚
                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Where This Runs
OptionImplementationProsMWAA/AirflowPython task within DAGNative scheduling, integrates with sensorsGlue JobPySpark jobHandles large configs, writes Parquet directlyLambdaPython functionFast for small configs, triggered by EventBridge

Would you like me to create the formal solution document with all these details included?
